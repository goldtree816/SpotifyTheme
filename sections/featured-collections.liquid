{{ 'featured-collections.css' | asset_url | stylesheet_tag }}

<section class="featured-collections section-{{ section.id }}" aria-label="Featured collection">
	<div class="fc-container">
		<div class="fc-header">
			{% if section.settings.heading != blank %}
				<h2 class="fc-title">{{ section.settings.heading }}</h2>
			{% endif %}
			{% if section.settings.subheading != blank %}
				<div class="fc-subtitle rte">{{ section.settings.subheading }}</div>
			{% endif %}
		</div>

		{%- assign collection = section.settings.collection -%}
		
		

		<div class="fc-grid">
			{%- if collection and collection.products_count > 0 -%}
				{%- for product in collection.products limit: 4 -%}
					{%- assign card_size = 'fc-card--sm' -%}
					{%- if forloop.first -%}
						{%- assign card_size = 'fc-card--xl' -%}
					{%- elsif forloop.index == 2 -%}
						{%- assign card_size = 'fc-card--wide' -%}
					{%- endif -%}

					<div class="fc-card {{ card_size }}">
						

						{%- assign product_image = product.featured_media | default: product.featured_image -%}
						<a class="fc-card__link" href="{{ product.url }}">
							{%- if product_image -%}
								{%- assign image_width = 1200 -%}
								{%- if card_size == 'fc-card--sm' -%}
									{%- assign image_width = 800 -%}
								{%- endif -%}
								{{ product_image | image_url: width: image_width | image_tag: 
									loading: 'lazy', 
									class: 'fc-card__image', 
									widths: '400, 600, 800, 900, 1200', 
									sizes: '(min-width: 990px) 40vw, 100vw', 
									alt: product.title 
								}}
							{%- else -%}
								{{ 'product-' | append: forloop.index | placeholder_svg_tag }}
							{%- endif -%}
							<span class="fc-card__action" aria-hidden="true">+</span>
						</a>
						<div class="fc-card__overlay">
							<button type="button" class="fc-buy-now" 
								data-variant-id="{{ product.selected_or_first_available_variant.id }}" 
								{% unless product.available %}disabled{% endunless %}>
								Buy now - {{ product.price | money }}
							</button>
						</div>
					</div>
				{%- endfor -%}
			{%- else -%}
				<div class="fc-empty">Select a collection with at least one product to display this section.</div>
			{%- endif -%}
		</div>
	</div>
</section>

<script>
document.addEventListener('click', function(event) {
	var button = event.target.closest('.fc-buy-now');
	if (!button) return;
	
	event.preventDefault();
	event.stopPropagation();
	
	var variantId = button.getAttribute('data-variant-id');
	console.log('Clicked Buy Now - Variant ID:', variantId);
	
	if (!variantId || variantId === 'null' || variantId === '') {
		console.error('Invalid variant ID:', variantId);
		alert('Product variant not available');
		return;
	}
	
	button.disabled = true;
	button.textContent = 'Adding...';
	
	fetch('/cart/add.js', {
		method: 'POST',
		headers: { 
			'Content-Type': 'application/json', 
			'Accept': 'application/json' 
		},
		body: JSON.stringify({ 
			id: parseInt(variantId), 
			quantity: 1 
		})
	})
	.then(response => {
		console.log('Response status:', response.status);
		return response.json();
	})
	.then(data => {
		console.log('Added to cart:', data);
		window.location.href = '/checkout';
	})
	.catch(error => {
		console.error('Error adding to cart:', error);
		button.disabled = false;
		button.textContent = 'Buy now';
		alert('Error adding to cart: ' + error.message);
	});
});
</script>

{% schema %}
{
	"name": "Featured collections",
	"settings": [
		{ "type": "text", "id": "heading", "label": "Heading", "default": "Content Heading" },
		{ "type": "richtext", "id": "subheading", "label": "Subheading", "default": "<p>Browse through our handpicked selections tailored to fit every style, time, and vibe. Whether you're seeking a rising standout, we've got something for everyone.</p>" },
		{ "type": "collection", "id": "collection", "label": "Collection" }
	],
	"presets": [
		{ "name": "Featured collections", "category": "Featured" }
	]
}
{% endschema %}